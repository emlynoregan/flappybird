<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Flappy Bird - Web Game</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="back-button">
        <a href="https://emlynoregan.com" id="back-link">‚Üê back</a>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div id="loading-content">
            <div id="loading-bird">üê¶</div>
            <div id="loading-text">Loading Flappy Bird Game...</div>
            <div id="loading-progress">
                <div id="loading-bar"></div>
            </div>
            <div id="loading-status">Initializing...</div>
        </div>
    </div>
    
    <div id="game-container">
        <div id="game-canvas"></div>
    </div>
    
    <div id="dev-story">
        <p>I vibe coded this game in just under three hours end to end using <strong>Claude-4-Sonnet</strong> via <strong>Cursor's Agent</strong>, in <em>YOLO mode</em>. üöÄ</p>
    </div>
    
    <!-- Phaser.js CDN - Multiple fallback sources -->
    <script>
        // Loading progress tracking
        let loadingProgress = 0;
        const totalSteps = 10; // 1 for Phaser + 8 game scripts + 1 for initialization
        
        function updateLoadingProgress(step, status) {
            loadingProgress = step;
            const percentage = Math.round((loadingProgress / totalSteps) * 100);
            
            const progressBar = document.getElementById('loading-bar');
            const statusText = document.getElementById('loading-status');
            
            if (progressBar) {
                progressBar.style.width = percentage + '%';
            }
            
            if (statusText) {
                statusText.textContent = status;
            }
            
            console.log(`Loading Progress: ${percentage}% - ${status}`);
        }
        
        function hideLoadingOverlay() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 500);
            }
        }
        
        // Make hideLoadingOverlay available globally
        window.hideLoadingOverlay = hideLoadingOverlay;
        
        // Try multiple CDN sources in order
        const phaserCDNs = [
            'https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js',
            'https://unpkg.com/phaser@3.70.0/dist/phaser.min.js',
            'https://cdnjs.cloudflare.com/ajax/libs/phaser/3.70.0/phaser.min.js'
        ];
        
        let cdnIndex = 0;
        
        function loadGameScripts() {
            // Load all game scripts in order after Phaser is loaded
            const scripts = [
                'js/config.js',
                'js/audio/SoundManager.js',
                'js/objects/Bird.js',
                'js/objects/PipeGroup.js',
                'js/scenes/BootScene.js',
                'js/scenes/MenuScene.js',
                'js/scenes/GameScene.js',
                'js/scenes/GameOverScene.js',
                'js/game.js'
            ];
            
            let scriptIndex = 0;
            
            function loadNextScript() {
                if (scriptIndex >= scripts.length) {
                    updateLoadingProgress(totalSteps, 'Starting game...');
                    console.log('üéÆ All game scripts loaded successfully!');
                    
                    // Initialize the game now that all scripts are loaded
                    setTimeout(() => {
                        if (window.initializeFlappyBirdGame) {
                            window.initializeFlappyBirdGame();
                        }
                    }, 100);
                    
                    return;
                }
                
                updateLoadingProgress(2 + scriptIndex, `Loading ${scripts[scriptIndex].split('/').pop()}...`);
                
                const script = document.createElement('script');
                script.src = scripts[scriptIndex];
                script.onload = function() {
                    console.log('üìú Loaded:', scripts[scriptIndex]);
                    scriptIndex++;
                    loadNextScript();
                };
                script.onerror = function() {
                    console.error('‚ùå Failed to load script:', scripts[scriptIndex]);
                    updateLoadingProgress(2 + scriptIndex, `Error loading ${scripts[scriptIndex].split('/').pop()}`);
                    scriptIndex++;
                    loadNextScript();
                };
                document.head.appendChild(script);
            }
            
            loadNextScript();
        }
        
        function loadPhaser() {
            if (cdnIndex >= phaserCDNs.length) {
                document.getElementById('loading-content').innerHTML = '<div style="color: red; text-align: center;">‚ùå Error: Could not load Phaser.js from any CDN.<br><br>Please check your internet connection and try:<br>1. Refreshing the page<br>2. Disabling ad blockers<br>3. Checking firewall settings</div>';
                return;
            }
            
            updateLoadingProgress(1, 'Loading Phaser.js...');
            
            const script = document.createElement('script');
            script.src = phaserCDNs[cdnIndex];
            script.onload = function() {
                console.log('‚úÖ Phaser.js loaded successfully from:', phaserCDNs[cdnIndex]);
                console.log('üì¶ Phaser Version:', typeof Phaser !== 'undefined' ? Phaser.VERSION : 'Unknown');
                
                updateLoadingProgress(1, 'Phaser.js loaded!');
                
                // Now load all game scripts in sequence
                setTimeout(loadGameScripts, 100);
            };
            script.onerror = function() {
                console.log('‚ùå Failed to load from:', phaserCDNs[cdnIndex]);
                cdnIndex++;
                loadPhaser();
            };
            document.head.appendChild(script);
        }
        
        // Start loading immediately
        updateLoadingProgress(0, 'Initializing...');
        loadPhaser();
        
        // Fallback: Hide loading overlay after 10 seconds if something goes wrong
        setTimeout(() => {
            const overlay = document.getElementById('loading-overlay');
            if (overlay && overlay.style.display !== 'none') {
                console.warn('Loading took too long, hiding overlay as fallback');
                hideLoadingOverlay();
            }
        }, 10000);
    </script>

    
    <!-- Game scripts will be loaded dynamically after Phaser loads -->
</body>
</html> 